<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bitcamp.java77.dao.WishDao">

	<resultMap type="wish" id="wishMap">
		<id 	column="wno" 		property="no"/>
		<result column="FPATH" 		property="path"/>
		<result column="CONT" 	property="content"/>
	</resultMap>
	
	
   	<!-- 게시글 등록하기 -->
	<insert id="insert" parameterType="wish">
		insert into wish(fpath, title, cont, price, url, tag, cno, uno) 
		values(#{path}, #{title}, #{content}, #{price}, #{url}, #{tag}, #{cno}, #{uno})
	</insert>
	
	<!-- 유저의 디폴트카테고리 번호 반환 -->
	<select id="selectcNo" resultType="int">
		select min(cno) from category where uno=#{uno}
	</select>
  	
  	<!-- 게시글번호 불러오기  -->
	<select id="selectNo" resultType="int">
		select max(wno) from wish
	</select>
	
	
	
	<!-- 게시글 불러오기(페이징) -->
	<select id="selectList" resultMap="wishMap" parameterType="map">
		select wno, fpath, title, cont, price, url, buy, tag, date, cno, uno
		from wish
		where uno=#{uno}
		order by wno desc
		limit #{startIndex}, #{length}
	</select>
	
	<!-- 유저가 '좋아요'한 게시글 불러오기(페이징) -->
	<select id="selectLikeList" resultMap="wishMap" parameterType="map">
		select w.wno, w.fpath, w.title, w.cont, w.price, w.url, w.buy, w.tag, w.date, w.cno, w.uno
		from wish w, `like` l
		where  w.wno=l.wno and l.uno=#{uno}
		order by w.wno desc
		limit #{startIndex}, #{length}
	</select> 
	
	<!-- 유저별 게시글 총 개수 불러오기  -->
	<select id="selectWishCnt" resultType="int">
		select COUNT(*) from wish where uno=#{uno}
	</select>
	
	<!-- 유저별 좋아요 총 개수 불러오기  -->
	<select id="selectLikeCnt" resultType="int">
		select COUNT(*) from `like` where uno=#{uno}
	</select>	
	
	
	
  	<!-- 게시글 삭제하기 -->
	<delete id="delete">
		delete from wish where wno=#{no}
	</delete>
	
  	<!-- 게시글 좋아요 삭제하기 -->
	<delete id="deleteLike">
		delete from `like` where wno=#{no}
	</delete>
	
  	<!-- 게시글 담아가기 내역 삭제하기 (담아가기 테이블에서만 삭제됨, 담아가기 한 유저의 테이블에는 게시글이 남아있음) -->
	<delete id="deleteSend">
		delete from send where wno=#{no}
	</delete>
  
  
  
  	<!-- 게시글 수정하기 -->
	<update id="update" parameterType="wish">
		update wish 
		set fpath=#{path}, title=#{title}, cont=#{content}, price=#{price}, url=#{url}, tag=#{tag}, date=now()  	  
	    where wno=#{no}
	</update>
	
	<!-- 게시글 상세내용 불러오기 -->
	<select id="selectOne" resultMap="wishMap" parameterType="int">
		select wno, fpath, title, cont, price, url, buy, tag, date, cno from wish where wno=#{no}
	</select>
	
	<!-- 구매여부 업데이트하기 -->
	<update id="updateBuy" parameterType="wish">
		update wish 
		set buy=#{buy}
	    where wno=#{no}
	</update>
	
	
	<!-- 카테고리 등록하기 -->
	<insert id="insertCategory" parameterType="String">
		insert into category(cno, name, uno) 
		values(#{cno}, #{name}, #{uno})
	</insert>
	
	<!-- 카테고리 삭제하기 -->
	
	<!-- 카테고리 수정하기 -->
  
</mapper>






