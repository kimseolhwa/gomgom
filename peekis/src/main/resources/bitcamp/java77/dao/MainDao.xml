<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bitcamp.java77.dao.MainDao">

	<resultMap type="wish" id="wishMap">
		<id column="wno" property="no" />
		<result column="FPATH" property="path" />
		<result column="CONT" property="content" />
	</resultMap> 
	
	<!-- 위시부분 -->
	<select id="selectList" resultMap="wishMap" parameterType="map">
<!-- 		select wno, fpath, title, cont, price, url, buy, tag, date, cno, uno -->
<!-- 		  from wish -->
		select wish.*, user.name as userName, user.pho as userPho, category.name as categoryName
		  from wish, user, category
		 where wish.uno=user.uno=category.uno
		 order by
		<choose>
			<when test="keyword == 'title'">title </when>
			<when test="keyword == 'price'">price </when>
			<otherwise>wno desc</otherwise>
		</choose>
		limit #{startIndex}, #{length}
	</select>
	
	<select id="selectUserList" resultMap="wishMap" parameterType="map">
		select wish.*, user.name as userName, user.pho as userPho
		  from wish, user
		 where wish.uno=user.uno
		 order by
		<choose>
			<when test="keyword == 'title'">title </when>
			<when test="keyword == 'price'">price </when>
			<otherwise>wno desc</otherwise>
		</choose>
		limit #{startIndex}, #{length}
	</select>

	<select id="selectNo" resultType="int">
		select max(wno) from wish
	</select>

	<select id="selectOne" resultMap="wishMap" parameterType="int">
<!-- 		select wno, fpath, title, cont, price, url, buy, tag, date, cno, uno -->
<!-- 		  from wish -->
<!-- 		 where wno=#{no} -->
<!-- 		   and wish.uno=user.uno=category.uno -->
		select wish.*, user.name as userName, user.pho as userPho, category.name as categoryName
		  from wish, user, category
		 where wno=#{no}
           and wish.uno=user.uno=category.uno
	</select>
	
	<!-- 좋아요 -->
	<insert id="addLike" parameterType="map">
		insert into `like`(wno, uno) 
		values(#{wno}, #{uno})
	</insert>
	
	<delete id="deleteLike" parameterType="map">
		delete
		  from `like`
		 where wno=#{wno} and uno=#{uno}
	</delete>

	<select id="selectlikeList" resultType="int" parameterType="int">
		select wno
		  from `like`
		 where uno=#{uno}
	</select>
	
	
	<!-- 담아가기 -->
	<insert id="send" parameterType="map">
		insert into SEND(wno, uno) 
		values(#{wno}, #{uno})
	</insert>
	
	<insert id="copyItem" parameterType="int">
		<selectKey keyProperty="cno" order="BEFORE" resultType="int">
	      select min(cno) from category where uno=#{uno}
	    </selectKey>
		insert into wish( fpath, title, cont, price, url, tag, cno, uno) 
		select w1.fpath, w1.title, w1.cont, w1.price, w1.url, w1.tag, cno, #{uno}
		  from wish w1
		 where wno=#{wno}
	</insert>
	
	<!-- 팔로워 -->
	<insert id="follower" parameterType="map">
		insert into follower(uno, uno2) 
		values(#{toUser}, #{fromUser})
	</insert>

	
	<!-- 코멘트 등록 -->
	<insert id="insertComment" parameterType="comment">
		insert into comment (wno, uno,cont) 
		values(#{wNo}, #{uNo},#{cont})
	</insert>
	

</mapper>