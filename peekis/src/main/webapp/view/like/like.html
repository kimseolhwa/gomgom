<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>gomgom myList</title>
<!-- jQuery -->
<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="../../js/jquery.number.js"></script>

<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" >
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!-- Isotope -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>

<!-- btn-orange -->
<link rel="stylesheet" href="../../css/btn-orange.css">

<!-- imagesLoaded -->
<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>

<!-- sweetalert -->
<script src="../../js/sweetalert-dev.js"></script>
<link rel="stylesheet" style="text/css" href="../../css/sweetalert.css" />

<!-- 헤더푸터 위치 페이지 사이즈  조절 -->
<link rel="stylesheet" style="text/css" href="../../css/global.css"/>
<!-- css -->
<link rel="stylesheet" style="text/css" href="../../css/common.css" />
<link rel="stylesheet" style="text/css" href="../../css/header.css" />
<link rel="stylesheet" style="text/css" href="../../css/footer.css" />
<link rel="stylesheet" style="text/css" href="../../css/btn-orange.css" />
<link rel="stylesheet" style="text/css" href="../../css/profile.css" />
<link rel="stylesheet" style="text/css" href="../../css/main.css" />


<style>
.userInfo a:nth-child(3) div {
	color: #f28435;
	font-weight: bold;
}
</style>
</head>
<body>
	<header id="header"></header>
	
	<section>
		<div id="user-profile"></div>
		
		<div id="main-content">
							
				<div class="item_container">
					<div id="pageNo" style="display: none;">1</div>
					<div id="UserNo" style="display: none;">0</div>
				</div>
		
				<div class="cloneMainContents" style="display: none;">
					<div class="item">
						<div class="product">
							<img src="../../image/005.jpg" />
							<input type="hidden" class="no" value="00">
							<input type="hidden" class="uno" value="00">
							<div class="mask">
								<div class="icon">
									<button class="btn btn-orange">
										<span class="glyphicon glyphicon-send"></span>
									</button>
									<button class="btn btn-orange plus">
										<span class="glyphicon glyphicon-plus"></span>
									</button>
									<a href="#Modal1" data-toggle="modal">
									<button class="detail btn btn-orange">상세보기</button></a>
								</div>
							</div>
						</div>
						<div class="pro">
							<a href="#ProModal1" data-toggle="modal"> <img src="../../image/pro1.jpg" class="img-circle">
								<div class="user_id">아이디는여덟자임</div>
							</a> <span class="glyphicon glyphicon-folder-open"></span>
							<div class="user_wish">폴더이름여덟자임</div>
							<div class="heart"></div>
							<div class="undoheart"></div>
						</div>
					</div>
				</div>
		</div>
	</section>
		
	<footer id="footer"></footer>
	
	
<script>
	$("#header").load("../header/header.html");
	$("#footer").load("../footer/footer.html");
	$("#user-profile").load("../profile/profile.html");
</script>
<script>
$(document).ready(function() {
	
	var $container = $('.item_container');
    $container.isotope({
       itemSelector : '.item',
       percentPosition : true,
       masonry: { columnWidth : 1, rowHeight: 1 }
    });
    var sort = function(){
  	  $container.imagesLoaded(function() {
  	  	$container.isotope();
  	  });
    }
	
	/* 리스트 불러오기 */
	nextPage(1);
	
	$(window).scroll(function(){
		var scrollHeight = $(window).scrollTop() + $(window).height();
		var documentHeight = $(document).height();
		if(scrollHeight >= documentHeight -100){
			console.log('스크롤 이벤트 발생');
			var pageNo = Number($('#pageNo').text()) +1;
			nextPage(pageNo);
		}
	});
	  
	function nextPage(pageNo){
		 $.getJSON('/peekis/wish/ajax/likeList.do',{pageNo : pageNo}, function(resultObj) {
			$("#UserNo").text(resultObj.loginUser.uNo);
			$('#pageNo').text(pageNo);
			console.log(resultObj);
			for (var wish of resultObj.data){
 				  $('#pageNo').text(pageNo);
 				  var cloneContent = $('.cloneMainContents > div').clone();
 					cloneContent.addClass(wish.no+'');
 					cloneContent.find('.no').val(wish.no);
 					cloneContent.find('.uno').val(wish.uno);
 					var path = wish.path;
 					if(path.startsWith('http://') == false){
 						path = filePath + path;
 					}
 					cloneContent.find('img:first').attr('src', path);
 					cloneContent.find('.userPho').attr('src', filePath + wish.userPho);
 					cloneContent.find('.user_id').html(wish.userName);
 					cloneContent.find('.undoheart').css('display','block');
 					cloneContent.find('.heart').css('display','none');
 					$items = $(cloneContent);
 					$container.append( $items ).isotope( 'appended', $items );			
			  	}
			sort();
		});
	}
	
	
	/* 좋아요 취소 */
	$(document).on('click', '.undoheart', function(){
		console.log('좋아요 취소이벤트 발생');
		var wishNo = $(this).closest('.item').find('.no').val();
		var uNo = $('#UserNo').text();
    	$.getJSON('/peekis/main/ajax/deleteLike.do', {wno : wishNo, uno : uNo}, function(resultObj) {
    		var result = resultObj.ajaxResult;
    		console.log(result);
			if(result.status == 'success'){
        		$('.' + wishNo).find('.undoheart').toggleClass('toggle').show().fadeToggle(1000),
        		setTimeout(function(){
        			$('.' + wishNo).find('.undoheart').toggleClass('toggle');  
				   },1000), 
        		$('.' + wishNo).find('.heart').hide().fadeToggle(1000);
        		setTimeout(function(){
	        		$container.isotope( 'remove', $("." + wishNo) ).isotope();
					$("#likeCnt").text( Number($('#likeCnt').text()) -1);
        		},1000);
			}else{
				swal('좋아요 삭제에 실패하였습니다.');
			}
		});
	});
});
</script>
</body>
</html>