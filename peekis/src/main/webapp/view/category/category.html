<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>gomgom myList</title>
<!-- jQuery -->
<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<!-- 부트스트랩 -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<script type="text/javascript" src="../../js/common.js"></script>

<!-- 헤더푸터 위치 페이지 사이즈  조절 -->
<link rel="stylesheet" style="text/css" href="../../css/global.css" />

<!-- css -->
<link rel="stylesheet" style="text/css" href="../../css/common.css" />
<link rel="stylesheet" style="text/css" href="../../css/header.css" />
<link rel="stylesheet" style="text/css" href="../../css/footer.css" />
<link rel="stylesheet" style="text/css" href="../../css/btn-orange.css" />
<link rel="stylesheet" style="text/css" href="../../css/profile.css" />
<link rel="stylesheet" style="text/css" href="../../css/category.css" />

<!-- Isotope -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>

<!-- imagesLoaded -->
<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.js"></script>

<link rel="stylesheet" href="https://npmcdn.com/flickity@1.2/dist/flickity.css" media="screen">
<script src="https://npmcdn.com/flickity@1.2/dist/flickity.pkgd.js"></script>

<!-- alert -->
<script src="../../js/sweetalert-dev.js"></script>
<link rel="stylesheet" style="text/css" href="../../css/sweetalert.css" />

<script type="text/javascript">
$(document).ready(function() {
	
	var $container = $('.c_container');
    $container.flickity({
       cellAlign: 'left',
       contain: true
    });
	
	$('.add-category').click(function () {
		swal({title: "폴더 만들기",
			   text: "위시리스트를 담을 폴더를 만들어 주세요:",
			   type: "input",
			   showCancelButton: true,
			   closeOnConfirm: false,
			   animation: "slide-from-top",
			   inputPlaceholder: "폴더 명을 적어주세요" },
			   function(inputValue){
				   if (inputValue === false) return false;
				   if (inputValue === "")
				   {swal.showInputError("제대로 입력해 주세요!");
				   return false}
				   swal("폴더 생성!", "만드신 폴더: " + inputValue, "success") 
				   
				  $.ajax({
				  type: "POST",
		  		  dataType:"JSON",
		  	 	  url : '/peekis/category/ajax/addCategory.do',
		  	 	  data:{'name': inputValue},
		  	 	  success: function(resultObj){
					console.log(resultObj)
	  	 			var category = resultObj.category;
					console.log(resultObj.category.name)
					var cloneContent = $(".cloneCategory > div").clone();
					cloneContent.addClass(category.cNo+"");
					cloneContent.find('.categoryName').html(resultObj.category.name);
					$items = $(cloneContent);
   					$container.append( $items ).flickity( 'append', $items );	
		  	 	  }
				})
			});
	  });
	
	 $.getJSON('/peekis/category/ajax/categoryList.do', function(resultObj) {
		 $("#UserNo").text(resultObj.loginUser.uNo);
			 console.log(resultObj)
		 for (var category of resultObj.data){
			 var cloneContent = $(".cloneCategory > div").clone();
				cloneContent.addClass(category.cNo+"");
				cloneContent.find('.categoryName').html(category.name);
				cloneContent.find('.path1').attr('src', category.path1);
				cloneContent.find('.path2').attr('src', category.path2);
				cloneContent.find('.path3').attr('src', category.path3);
				cloneContent.find('.path4').attr('src', category.path4);
				$items = $(cloneContent);
				$container.append( $items ).flickity( 'append', $items );			
		  	}
		});
	 
	 var $container2 = $('.item_container');
     $container2.isotope({
        itemSelector : '.item',
        percentPosition : true
     });
     
     var sort = function(){
   	  $container2.imagesLoaded(function() {
   	  	$container2.isotope();
   	  });
     }
	 
	 nextPage(1);
     
     $(window).scroll(function(){
     	var scrollHeight = $(window).scrollTop() + $(window).height();
     	var documentHeight = $(document).height();
     	if(scrollHeight >= documentHeight -100){
     		console.log("스크롤 이벤트 발생");
     		var pageNo = Number($('#pageNo').text()) +1;
     		nextPage(pageNo);
     	}
     });
       
     function nextPage(pageNo){
 		$(document).on('click', '.category', function (){
    		console.log($(this).text())
     	 $.getJSON('/peekis/category/ajax/categoryWishList.do',{pageNo : pageNo},function(resultObj) {
     		 for (var wish of resultObj.data){
     			console.log(resultObj)
					$('#pageNo').text(pageNo);
					var cloneContent = $(".cloneMainContents > div").clone();
					cloneContent.addClass(wish.no+"");
					cloneContent.find('.no').val(wish.no);
					var path = wish.path;
					if(path.startsWith('http://') == false){
						path = filePath + path;
					}
					if(wish.buy == 'Y'){
						cloneContent.find('.buy').addClass('buy-check');
					}
					cloneContent.find('img:first').attr("src", path);
					$items2 = $(cloneContent);
					$container2.append( $items ).isotope( 'appended', $items2 );			
			  	}
     		 sort();
			});
     	 })
     }
     
     $('#filters').on('click', 'button', function() {
			var filterValue = $(this).attr('data-filter');
			$container.isotope({
				filter : filterValue
			});
		});
	 
});
</script>


</head>
<body>
	<header id="header"></header>

	<section>

		<div id="user-profile"></div>

		<div id="main-content">
			<div class="c_container carousel">
				<div class="addCategory">
					<div class="add-category">
						<div style="padding: 30px 0 20px 0;">
							<i class="fa fa-plus-circle fa-3x"></i>
						</div>
						<h4 style="margin: 0;">카테고리 추가</h4>
					</div>
				</div>
			</div>

			<div class="cloneCategory" style="display: none;">
				<div class="category">
					<div class="categoryName">이름은 여기 표시</div>
					<input type="hidden" class="no" value="00">
					<div class="categoryImg">
						<img src="../../image/no_image(450X450).png" class="img-rounded path1"> <img src="../../image/no_image(450X450).png" class="img-rounded path2"> <img src="../../image/no_image(450X450).png" class="img-rounded path3"> <img src="../../image/no_image(450X450).png" class="img-rounded path4">
					</div>
					<button class="btn btn-orange">수정</button>
				</div>
			</div>

			<div class="filter">
				<div id="filters" class="btn-group">
					<button class="button is-checked btn btn-orange" data-filter="*">모두 보기</button>
					<button class="button btn btn-orange" data-filter=".friend">친구</button>
				</div>
			</div>

			<div class="item_container">
				<div id="pageNo" style="display: none;">1</div>
				<div id="UserNo" style="display: none;">0</div>
			</div>

			<div class="cloneMainContents" style="display: none;">
				<div class="item">
					<div class="product">
						<img src="../../image/no_image(235x400).png" /> <input type="hidden" class="no" value="00">
						<div class="mask">
							<div class="icon">
								<a href="#Modal1" data-toggle="modal"><button class="detail btn btn-orange">상세보기</button></a>
							</div>
						</div>
					</div>
					<div class="wish-menu">
						<i class="fa fa-bookmark buy"></i> <i class="fa fa-pencil"></i> <i class="fa fa-trash-o"></i>
					</div>
				</div>
			</div>
		</div>

	</section>

	<footer id="footer"></footer>


	<script>
	$("#header").load("../header/header.html");
	$("#footer").load("../footer/footer.html");
	$("#user-profile").load("../profile/profile.html");
</script>

</body>
</html>