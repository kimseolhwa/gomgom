<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 위 3개의 메타 태그는 *반드시* head 태그의 처음에 와야합니다; 어떤 다른 콘텐츠들은 반드시 이 태그들 *다음에* 와야 합니다 -->
<title>메인 화면</title>

<!-- jQuery -->
<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="../../js/jquery.number.js"></script>

<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!-- Isotope -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>

<!-- btn-orange -->
<link rel="stylesheet" href="../../css/btn-orange.css">

<!-- CSS -->
<link rel="stylesheet" href="../../css/main.css">


<!-- header, footer -->
<link rel="stylesheet" style="text/css" href="../../css/header.css" />
<link rel="stylesheet" style="text/css" href="../../css/footer.css" />
<link rel="stylesheet" style="text/css" href="../../css/global.css" />

<!-- imagesLoaded -->
<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>

<script>
	$(document).ready(function() {
		
				/* 좋아요 토글 이벤트 */
				$(document).on('click', '.heart', function(){
							console.log('좋아요 이벤트 발생');
							var wishNo = $(this).closest('.item').find('.no').val();
							var uNo = $('#UserNo').text();
				        	$.getJSON('/peekis/main/ajax/addLike.do', {wno : wishNo, uno : uNo}, function(resultObj) {
				        		var result = resultObj.ajaxResult;
				        		console.log(result);
				    			if(result.status == 'success'){
					        		$('.' + wishNo).find('.heart').toggleClass('toggle').show().fadeToggle(1000),
					        		setTimeout(function(){
					        			$('.' + wishNo).find('.heart').toggleClass('toggle');  
									   },1000), 
					        		$('.' + wishNo).find('.undoheart').hide().fadeToggle(1000);
				    			}else{
				    				alert('좋아요 추가에 실패하였습니다.');
				    			}
				    		});
						});

				$(document).on('click', '.undoheart', function(){
							console.log('좋아요 취소이벤트 발생');
							var wishNo = $(this).closest('.item').find('.no').val();
							var uNo = $('#UserNo').text();
				        	$.getJSON('/peekis/main/ajax/deleteLike.do', {wno : wishNo, uno : uNo}, function(resultObj) {
				        		var result = resultObj.ajaxResult;
				        		console.log(result);
				    			if(result.status == 'success'){
					        		$('.' + wishNo).find('.undoheart').toggleClass('toggle').show().fadeToggle(1000),
					        		setTimeout(function(){
					        			$('.' + wishNo).find('.undoheart').toggleClass('toggle');  
									   },1000), 
					        		$('.' + wishNo).find('.heart').hide().fadeToggle(1000);
				    			}else{
				    				alert('좋아요 삭제에 실패하였습니다.');
				    			}
				    		});
						});
				
				
				var $container = $('.item_container');
		          $container.isotope({
		             itemSelector : '.item',
		             percentPosition : true,
		             masonry: { columnWidth : 1, rowHeight: 1 }
		          });
		          $container.imagesLoaded().progress(function() {
		        	  $container.isotope();
		          });
		          
		        /* 리스트 불러오기 */
				nextPage(1);

		        $(window).scroll(function(){
		        	var scrollHeight = $(window).scrollTop() + $(window).height();
		        	var documentHeight = $(document).height();
		        	if(scrollHeight >= documentHeight -100){
		        		console.log('스크롤 이벤트 발생');
		        		var pageNo = Number($('#pageNo').text()) +1;
		        		nextPage(pageNo);
		        	}
		        });
		          
		        function nextPage(pageNo){
		        	 $.getJSON('/peekis/main/ajax/list.do',{pageNo : pageNo}, function(resultObj) {
		        		 $("#UserNo").text(resultObj.loginUser.uNo);
		        		  console.log(resultObj);
			   			  for (var wish of resultObj.data){
			   				  $('#pageNo').text(pageNo);
			   				  var cloneContent = $('.cloneMainContents > div').clone();
			   					cloneContent.addClass(wish.no+'');
			   					cloneContent.find('.no').val(wish.no);
			   					cloneContent.find('.uno').val(wish.uno);
			   					var path = wish.path;
			   					if(path.startsWith('http://') == false){
			   						path = filePath + path;
			   					}
			   					if(wish.buy == 'Y'){
			   						cloneContent.find('.buy').addClass('buy-check');
			   					}
			   					cloneContent.find('img:first').attr('src', path);
			   					$items = $(cloneContent);
			   					$container.append( $items ).isotope( 'appended', $items );			
		   			  	}
			   			for (var like of resultObj.like){
			   				$('.' + like).find('.undoheart').css('display','block');
			   				$('.' + like).find('.heart').css('display','none');
			   			}
			   			if(pageNo == 1){
		        			console.log(resultObj);
		        			$("#dropdown-color").text(resultObj.loginUser.name);
		        		}
		   			});
		        }
		        
		        /* 상세정보 가져오기 */
				$container.on( 'click', '.detail', function() {
					var wishNo = $(this).closest('.item').find('.no').val();
					$.getJSON('/peekis/main/ajax/detail.do', {no : wishNo} , 
						function( resultObj ) {
							var wish = resultObj.ajaxResult.data;
							console.log(wish);
							$("#detailmodal-no").html( wish.no );
							var path = wish.path;
							if(path.startsWith('http://') == false){
								path = filePath + path;
							}
							$("#detailmodal-image").attr("src", path );
							$("#detailmodal-title").html( wish.title );			
							$("#detailmodal-content").html( wish.content );
							$("#detailmodal-price").html('&#8361;&nbsp;' + $.number(wish.price));
							$("#detailmodal-url").attr("onclick", "window.open('" + wish.url + "')");
							$("#detailmodal-tag").html("");
							$('#detailmodal').modal();
						});
				});
				
		        /* 게시글 담아가기 */
		        $(document).on("click", ".retweet", function(){
		        	var wishNo = $(this).closest('.item').find('.no').val();
		        	var uNo = $('#UserNo').text();
					$.getJSON('/peekis/main/ajax/send.do', {wno : wishNo, uno : uNo}, 
						function( resultObj ) {
							alert("담아가기 성공");
							console.log(resultObj);
						});
		        });
		        
				$('#filters').on('click', 'button', function() {
					var filterValue = $(this).attr('data-filter');
					$container.isotope({
						filter : filterValue
					});
				});

				$(".btn-pref .btn").click(
						function() {
							$(".btn-pref .btn").removeClass("btn-orange")
									.addClass("btn-default");
							$(this).removeClass("btn-default").addClass(
									"btn-orange");
						});
				
				var didScroll;
				var lastScrollTop = 0;
				var delta = 5;
				var navbarHeight = $('footer').outerHeight();

				$(window).scroll(function(event){
				    didScroll = true;
				});

				setInterval(function() {
				    if (didScroll) {
				        hasScrolled();
				        didScroll = false;
				    }
				}, 250);

				function hasScrolled() {
				    var st = $(this).scrollTop();
				    
				    if(Math.abs(lastScrollTop - st) <= delta)
				        return;
				    
				    if (st > lastScrollTop && st > navbarHeight){
				        $('footer').removeClass('nav-down').addClass('nav-up');
				    } else {
				        if(st + $(window).height() < $(document).height()) {
				            $('footer').removeClass('nav-up').addClass('nav-down');
				        }
				    }
				    lastScrollTop = st;
				}
			});
</script>
</head>
<body>
	<header id="header"></header>

	<div class="filter">
		<div id="filters" class="btn-group">
			<button class="button is-checked btn btn-orange" data-filter="*">모두 보기</button>
			<button class="button btn btn-orange" data-filter=".friend">친구</button>
		</div>
	</div>

	<div class="main">
		<div class="item_container">
			<div id="pageNo" style="display: none;">1</div>
			<div id="UserNo" style="display: none;">0</div>
		</div>

		<div class="cloneMainContents" style="display: none;">
			<div class="item">
				<div class="product">
					<img src="../../image/005.jpg" />
					<input type="hidden" class="no" value="00">
					<input type="hidden" class="uno" value="00">
					<div class="mask">
						<div class="icon">
							<button class="btn btn-orange">
								<span class="glyphicon glyphicon-send"></span>
							</button>
							<button class="btn btn-orange retweet">
									<span class="glyphicon glyphicon-retweet"></span>
							</button>
							<a href="#Modal1" data-toggle="modal">
							<button class="detail btn btn-orange">상세보기</button></a>
						</div>
					</div>
				</div>
				<div class="pro">
					<a href="#ProModal1" data-toggle="modal"> <img src="../../image/pro1.jpg" class="img-circle">
						<div class="user_id">아이디는여덟자임</div>
					</a> <span class="glyphicon glyphicon-folder-open"></span>
					<div class="user_wish">폴더이름여덟자임</div>
					<div class="heart"></div>
					<div class="undoheart"></div>
				</div>
			</div>
		</div>

		<!-- DetailModal -->
		<div class="item-modal modal fade" id="detailmodal" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<div class="modal-pro">
							<a href="#ProModal1" data-toggle="modal"> <img src="../../image/pro1.jpg" class="img-circle">
								<div class="modal-user_id">아이디는여덟자임</div>
							</a> <span class="glyphicon glyphicon-folder-open"></span>
							<div class="modal-user_wish">폴더이름여덟자임</div>
							<p>팔로우</p>
						</div>
						<button type="button" class="btn btn-orange" data-dismiss="modal">닫기</button>
					</div>
					<div class="modal-body">
						<input type="hidden" class="no" id="detailmodal-no">
						<div class="item-image">
							<img src="../../image/1111.jpg" alt="" id="detailmodal-image">
						</div>

						<div class="item-content">
							<div class="item-title" id="detailmodal-title">titel:</div>
							<br />
							<div class="item-subtitle" id="detailmodal-content">content:</div>
							<div class="item-costi-box">
								<div class="price" id="detailmodal-price">&#8361; price:</div>
							</div>
							<br />
							<div class="item-button-box">
								<button class="btn btn-default" id="detailmodal-url">
									<span class="glyphicon glyphicon-credit-card"> </span>구매하러 가기
								</button>
								<a href="#capymodal" data-toggle="modal"><button class="btn btn-default">담아가기</button></a>
								<button class="btn btn-default">좋아요</button>
							</div>
							<br />
							<div>
								<div class="btn-pref btn-group btn-group-justified btn-group-lg" role="group" aria-label="...">
									<div class="btn-group" role="group">
										<button id="comment" class="btn btn-orange" href="#tab1" data-toggle="tab">
											<div class="hidden-xs">댓글 0</div>
										</button>
									</div>
									<div class="btn-group" role="group">
										<button id="send" class="btn btn-default" href="#tab2" data-toggle="tab">
											<div class="hidden-xs">담아가기 0</div>
										</button>
									</div>
									<div class="btn-group" role="group">
										<button id="like" class="btn btn-default" href="#tab3" data-toggle="tab">
											<div class="hidden-xs">좋아요 0</div>
										</button>
									</div>
								</div>

								<div class="well">
									<div class="tab-content">
										<div class="tab-pane fade in active" id="tab1">
											<img src="../../image/pro1.jpg" class="img-circle">
											<p>댓글 내용 표시</p>
										</div>
										<div class="tab-pane fade in" id="tab2">
											<img src="../../image/pro1.jpg" class="img-circle">
											<p>댓글 내용 표시</p>
										</div>
										<div class="tab-pane fade in" id="tab3">
											<img src="../../image/pro1.jpg" class="img-circle">
											<p>댓글 내용 표시</p>
										</div>
									</div>
								</div>

								<div class="comment">
									<div class="comment_pro">
										<img src="../../image/pro1.jpg" class="img-circle">
										<div class="col-lg-10">
											<div class="input-group">
												<input type="text" class="form-control" placeholder="댓글을 입력해주세요"> <span class="input-group-btn">
													<button class="btn btn-default" type="button">입력</button>
												</span>
											</div>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- CapyModal -->
		<div class="item-modal modal fade" id="capymodal" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<div class="modal-pro">
							<a href="#ProModal1" data-toggle="modal"> <img src="../../image/pro1.jpg" class="img-circle">
								<div class="modal-user_id">아이디는여덟자임</div>
							</a> <span class="glyphicon glyphicon-folder-open"></span>
							<div class="modal-user_wish">폴더이름여덟자임</div>
							<p>팔로우</p>
						</div>
						<button type="button" class="btn btn-orange" data-dismiss="modal">닫기</button>
					</div>
					<div class="modal-body">
						<input type="hidden" class="no" id="detailmodal-no">
						<div class="item-image">
							<img src="../../image/1111.jpg" alt="" id="detailmodal-image">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="portfolio-modal modal fade" id="ProModal1" role="dialog" aria-hidden="true">
		<div class="modal-content">
			<div class="close-modal" data-dismiss="modal">
				<div class="lr">
					<div class="rl"></div>
				</div>
			</div>
			<div class="modal-body">
				<h2>프로필e</h2>
				<hr class="star-primary">
				<img src="../../image/pro1.jpg" class="img-rounded" alt="">

				<div class="modal-item">
					<div class="modal-product">
						<img src="../../image/006.jpg" />
					</div>
				</div>

				<div class="modal-item2">
					<div class="modal-product">
						<img src="../../image/002.jpg" />
					</div>
				</div>
			</div>
		</div>
	</div>

	<footer class="nav-down" id="footer"></footer>

	<span data-toggle="tooltip" data-placement="top" title="" id="demoTop" data-original-title="Going Up?"><a href="#" style="display: block; padding: 5px;">Δ</a></span>

	<script>
		$("#header").load("../header/header.html");
		$("#footer").load("../footer/footer.html");
	</script>
</body>
</html>
